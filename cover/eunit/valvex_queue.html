<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>/home/travis/build/hazardfn/valvex/_build/test/cover/eunit/valvex_queue.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /home/travis/build/hazardfn/valvex/_build/test/lib/valvex/ebin/../src/valvex_queue.erl by COVER 2016-08-04 at 16:18:03

****************************************************************************

        |  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        |  %%% @author Howard Beard-Marlowe &lt;howardbm@live.se&gt;
        |  %%% @copyright 2016 Howard Beard-Marlowe
        |  %%% @version 0.1.0
        |  %%% @end
        |  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        |  
        |  %% @doc valvex_queue
        |  %%
        |  %% This module defines the behaviour any queue backend should have
        |  %% read through the readme and the documentation for more info.
        |  
        |  -module(valvex_queue).
        |  
        |  -export([ crossover/3
        |          , get_state/2
        |          , is_consuming/2
        |          , is_locked/2
        |          , is_tombstoned/2
        |          , lock/2
        |          , pop/2
        |          , pop_r/2
        |          , push/3
        |          , push_r/3
        |          , size/2
        |          , start_consumer/2
        |          , start_link/3
        |          , stop_consumer/2
        |          , tombstone/2
        |          , unlock/2
        |          ]).
        |  
        |  %%==============================================================================
        |  %% Types
        |  %%==============================================================================
        |  
        |  -type queue_state() :: #{ key        =&gt; valvex:queue_key()
        |                          , threshold  =&gt; non_neg_integer()
        |                          , timeout    =&gt; non_neg_integer()
        |                          , pushback   =&gt; non_neg_integer()
        |                          , backend    =&gt; module()
        |                          , size       =&gt; non_neg_integer()
        |                          , poll_rate  =&gt; non_neg_integer()
        |                          , queue      =&gt; queue:queue()
        |                          , q          =&gt; valvex:valvex_queue()
        |                          , locked     =&gt; true | false
        |                          , tombstoned =&gt; true | false
        |                          , valvex     =&gt; valvex:valvex_ref()
        |                          , queue_pid  =&gt; valvex:valvex_ref()
        |                          , consumer   =&gt; undefined | timer:tref()
        |                          }.
        |  
        |  -export_type([queue_state/0]).
        |  
        |  %%======================================================================================================================
        |  %% Callbacks
        |  %%======================================================================================================================
        |  
        |  -callback crossover(Q :: valvex:valvex_ref(), NuQ :: valvex:valvex_queue()) -&gt; ok.
        |  
        |  -callback get_state(Q :: valvex:valvex_ref()) -&gt; queue_state().
        |  
        |  -callback is_consuming(Q :: valvex:valvex_ref() ) -&gt; true | false.
        |  
        |  -callback is_locked(Q :: valvex:valvex_ref() ) -&gt; true | false.
        |  
        |  -callback is_tombstoned(Q :: valvex:valvex_ref() ) -&gt; true | false.
        |  
        |  -callback lock(Q :: valvex:valvex_ref() ) -&gt; ok.
        |  
        |  -callback pop(Q :: valvex:valvex_ref() ) -&gt; any().
        |  
        |  -callback pop_r(Q :: valvex:valvex_ref() ) -&gt; any().
        |  
        |  -callback push(Q :: valvex:valvex_ref(), Value :: valvex:valvex_q_item()) -&gt; ok.
        |  
        |  -callback push_r(Q :: valvex:valvex_ref(), Value :: valvex:valvex_q_item()) -&gt; ok.
        |  
        |  -callback size( Q :: valvex:valvex_ref() ) -&gt; non_neg_integer().
        |  
        |  -callback start_consumer( Q :: valvex:valvex_ref() ) -&gt; ok.
        |  
        |  -callback start_link(Valvex :: valvex:valvex_ref(), Q :: valvex:valvex_queue()) -&gt; valvex:valvex_ref().
        |  
        |  -callback stop_consumer( Q :: valvex:valvex_ref() ) -&gt; ok.
        |  
        |  -callback tombstone( Q :: valvex:valvex_ref() ) -&gt; ok.
        |  
        |  -callback unlock( Q :: valvex:valvex_ref() ) -&gt; ok.
        |  
        |  %%======================================================================================================================
        |  %% API
        |  %%======================================================================================================================
        |  
        |  %% @doc This defines the crossover behaviour for your queue should you be developing
        |  %% your own backend take a look at how it is done in other stock modules if your module cannot
        |  %% work with this behaviour for any reason it is important that the user is made aware and something is logged.
        |  -spec crossover(valvex:queue_backend(), valvex:valvex_ref(), valvex:valvex_queue()) -&gt; ok.
        |  crossover(Backend, Q, NuQ) -&gt;
  1350..|    Backend:crossover(Q, NuQ).
        |  
        |  %% @doc Used to get information on the state of the queues.
        |  -spec get_state(valvex:queue_backend(), valvex:valvex_ref()) -&gt; queue_state().
        |  get_state(Backend, Q) -&gt;
  1224..|    Backend:get_state(Q).
        |  
        |  %% @doc Returns true if the consumer is started, false otherwise.
        |  -spec is_consuming(valvex:queue_backend(), valvex:valvex_ref()) -&gt; true | false.
        |  is_consuming(Backend, Q) -&gt;
   470..|    Backend:is_consuming(Q).
        |  
        |  %% @doc Whenever needed this should reply true or false depending on if
        |  %% the queue is locked, a locked queue is one that cannot be pushed to
        |  %% remaining work may continue to be consumed however view the stock
        |  %% backends or the readme for more info.
        |  -spec is_locked(valvex:queue_backend(), valvex:valvex_ref()) -&gt; true | false.
        |  is_locked(Backend, Q) -&gt;
    10..|    Backend:is_locked(Q).
        |  
        |  %% @doc Whenever needed this should reply true or false depending on if
        |  %% the queue is tombstoned, a tombstoned queue is marked for deletion
        |  %% and will delete itself when all work is consumed. A tombstoned
        |  %% queue does not have to be locked, this simply means it will stay
        |  %% alive as long as work is being passed to it.
        |  -spec is_tombstoned(valvex:queue_backend(), valvex:valvex_ref()) -&gt; true | false.
        |  is_tombstoned(Backend, Q) -&gt;
     6..|    Backend:is_tombstoned(Q).
        |  
        |  %% @doc This will lock a queue, a locked queue cannot be pushed to.
        |  -spec lock(valvex:queue_backend(), valvex:valvex_ref()) -&gt; ok.
        |  lock(Backend, Q) -&gt;
     6..|    Backend:lock(Q).
        |  
        |  %% @doc This will pop the queue, depending on your backends behaviour
        |  %% this can have different conotations see the documentation for your
        |  %% specific backend for more info.
        |  -spec pop(valvex:queue_backend(), valvex:valvex_ref()) -&gt; any().
        |  pop(Backend, Q) -&gt;
     8..|    Backend:pop(Q).
        |  
        |  %% @doc This will pop the queue but with the reverse operation of pop()
        |  %% this can have different conotations depending on your backends
        |  %% behaviour see the documentation for more info.
        |  -spec pop_r(valvex:queue_backend(), valvex:valvex_ref()) -&gt; any().
        |  pop_r(Backend, Q) -&gt;
     8..|    Backend:pop_r(Q).
        |  
        |  %% @doc This will push a queue item to the queue, this can have different conotations
        |  %% depending on your backend view its documentation for more information.
        |  %% @see valvex:valvex_q_item()
        |  -spec push(valvex:queue_backend(), valvex:valvex_ref(), valvex:valvex_q_item()) -&gt; ok.
        |  push(Backend, Q, Value) -&gt;
  1468..|    Backend:push(Q, Value).
        |  
        |  %% @doc This will do the reverse operation of push, this can have different conotations
        |  %% depending on your backend view its documentation for more information.
        |  -spec push_r( valvex:queue_backend(), valvex:valvex_ref(), valvex:valvex_q_item()) -&gt; ok.
        |  push_r(Backend, Q, Value) -&gt;
    38..|    Backend:push_r(Q, Value).
        |  
        |  %% @doc This function should retrieve the current size of the queue, if for some reason
        |  %% this is costly with your implementation make sure the user is notified this doesnt
        |  %% work.
        |  -spec size(valvex:queue_backend(), valvex:valvex_ref()) -&gt; non_neg_integer().
        |  size(Backend, Q) -&gt;
 97288..|    Backend:size(Q).
        |  
        |  %% @doc This function should start your consumer, this will be a regularly run
        |  %% function that slurps the queue.
        |  -spec start_consumer(valvex:queue_backend(), valvex:valvex_ref()) -&gt; ok.
        |  start_consumer(Backend, Q) -&gt;
  3228..|    Backend:start_consumer(Q).
        |  
        |  -spec start_link(valvex:queue_backend(), valvex:valvex_ref(), valvex:valvex_queue()) -&gt; {ok, valvex:valvex_ref()}.
        |  start_link(Backend, Valvex, Q) -&gt;
  4256..|    Backend:start_link(Valvex, Q).
        |  
        |  %% @doc This function should stop the consumer, note that it should not remove the queue
        |  %% entirely.
        |  -spec stop_consumer(valvex:queue_backend(), valvex:valvex_ref()) -&gt; ok.
        |  stop_consumer(Backend, Q) -&gt;
    26..|    Backend:stop_consumer(Q).
        |  
        |  %% @doc This function marks the queue for deletion, once the queue is empty it should be removed
        |  %% note a queue does not have to be locked to be tombstoned.
        |  -spec tombstone(valvex:queue_backend(), valvex:valvex_ref()) -&gt; ok.
        |  tombstone(Backend, Q) -&gt;
  1814..|    Backend:tombstone(Q).
        |  
        |  %% @doc This function unlocks a locked queue, it is idempotent.
        |  -spec unlock(valvex:queue_backend(), valvex:valvex_ref()) -&gt; ok.
        |  unlock(Backend, Q) -&gt;
     4..|    Backend:unlock(Q).
        |  
        |  %%%_* Emacs ====================================================================
        |  %%% Local Variables:
        |  %%% allout-layout: t
        |  %%% erlang-indent-level: 2
        |  %%% End:
</pre>
</body>
</html>
